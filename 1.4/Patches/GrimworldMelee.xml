<!--
    ===== Grimworld: Melee =====
-->
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Grimworld: Melee</li>
        </mods>

        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality" Name="MeleeWeapon_Chainsword_Bond" Abstract="True">
                            <label>persona Chainsword</label>
                            <description>Chainswords are not subtle weapons, and wielding one is a statement in its own right: they are horrific tools of war, designed to bite, tear and eviscerate where more primitive blades merely cut and slice.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <possessionCount>1</possessionCount>
                            <graphicData>
                                <texPath>Weapons/Chainsword</texPath>
                            </graphicData>
                            <uiIconScale>1.2</uiIconScale>
                            <techLevel>Industrial</techLevel>
                            <weaponTags>
                                <li>IndustrialMeleeDecent</li>
                            </weaponTags>
                            <statBases>
                                <Mass>2.85</Mass>
                            </statBases>
                            <relicChance>2</relicChance>
                            <equippedAngleOffset>-65</equippedAngleOffset>
                            <tools>
                                <li>
                                    <label>handle</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>13.162</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>edge</label>
                                    <capacities>
                                        <li>Cut</li>
                                    </capacities>
                                    <power>31.099</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality" Name="MeleeWeapon_Chainshortsword_Bond" Abstract="True">
                            <label>persona Chain Shortsword</label>
                            <description>Chainswords are not subtle weapons, and wielding one is a statement in its own right: they are horrific tools of war, designed to bite, tear and eviscerate where more primitive blades merely cut and slice.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <possessionCount>1</possessionCount>
                            <graphicData>
                                <texPath>Weapons/Chain Shortsword</texPath>
                            </graphicData>
                            <uiIconScale>1.2</uiIconScale>
                            <techLevel>Industrial</techLevel>
                            <weaponTags>
                                <li>IndustrialMeleeDecent</li>
                            </weaponTags>
                            <statBases>
                                <Mass>2.25</Mass>
                            </statBases>
                            <relicChance>2</relicChance>
                            <equippedAngleOffset>-65</equippedAngleOffset>
                            <tools>
                                <li>
                                    <label>handle</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>13.162</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>edge</label>
                                    <capacities>
                                        <li>Cut</li>
                                    </capacities>
                                    <power>24.472</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Blunt_Quality" Name="MeleeWeapon_TrenchShovel_Bond" Abstract="True">
                            <label>persona Trench Shovel</label>
                            <description>Trench Shovels are used by the Astra Militarum to dig trenches with. The Death Korps of Krieg have put such Shovels to legendary use in their service to the Imperium.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <possessionCount>1</possessionCount>
                            <graphicData>
                                <texPath>Weapons/Trench Shovel</texPath>
                            </graphicData>
                            <uiIconScale>1.2</uiIconScale>
                            <techLevel>Industrial</techLevel>
                            <statBases>
                                <Mass>1.5</Mass>
                            </statBases>
                            <equippedAngleOffset>-65</equippedAngleOffset>
                            <weaponTags>
                                <li>IndustiralMeleeDecent</li>
                            </weaponTags>
                            <weaponClasses>
                                <li>Melee</li>
                            </weaponClasses>
                            <tools>
                                <li>
                                    <label>handle</label>
                                    <capacities>
                                        <li>Poke</li>
                                    </capacities>
                                    <power>12.0</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>head</label>
                                    <labelUsedInLogging>false</labelUsedInLogging>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>21.907</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>
                        
                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Blunt_Quality" Name="MeleeWeapon_PowerFist_Bond" Abstract="True">
                            <label>persona Power Fist</label>
                            <description>A Power Fist is large and slow in combat, and so the bearer must be willing to risk the blows of his enemy before he can strike back. However, a Power Fist vastly augments a user's strength, much as power armour does due to the power provided its mechanical servos.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <possessionCount>1</possessionCount>
                            <graphicData>
                                <texPath>Weapons/Power Fist</texPath>
                            </graphicData>
                            <uiIconScale>1.2</uiIconScale>
                            <techLevel>Spacer</techLevel>
                            <statBases>
                                <Mass>4.4</Mass>
                            </statBases>
                            <equippedAngleOffset>-65</equippedAngleOffset>
                            <weaponTags>
                                <li>SpacerMeleeDecent</li>
                            </weaponTags>
                            <weaponClasses>
                                <li>Melee</li>
                            </weaponClasses>
                            <tools>
                                <li>
                                    <label>Fist</label>
                                    <labelUsedInLogging>false</labelUsedInLogging>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>46.325</power>
                                    <cooldownTime>3.23</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality" Name="MeleeWeapon_PowerSword_Bond" Abstract="True">
                            <label>persona Power Sword</label>
                            <description>Power Swords are one of the preeminent types of Power Weapons. When its power cell is activated, the blade becomes sheathed in a lethal haze of a disruptive energy field. This field allows the blade to easily rip through armor and flesh alike.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <possessionCount>1</possessionCount>
                            <graphicData>
                                <texPath>Weapons/Power Sword</texPath>
                            </graphicData>
                            <uiIconScale>1.2</uiIconScale>
                            <techLevel>Spacer</techLevel>
                            <weaponTags>
                                <li>SpacerMeleeDecent</li>
                            </weaponTags>
                            <statBases>
                                <Mass>1.6</Mass>
                            </statBases>
                            <relicChance>2</relicChance>
                            <equippedAngleOffset>-65</equippedAngleOffset>

                            <tools>
                                <li>
                                    <label>handle</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>12.0</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>point</label>
                                    <capacities>
                                        <li>Stab</li>
                                    </capacities>
                                    <power>35.477</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>edge</label>
                                    <capacities>
                                        <li>Cut</li>
                                    </capacities>
                                    <power>35.477</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality" Name="MeleeWeapon_PowerSwordtwo_Bond" Abstract="True">
                            <label>persona Power Sword</label>
                            <description>Power Swords are one of the preeminent types of Power Weapons. When its power cell is activated, the blade becomes sheathed in a lethal haze of a disruptive energy field. This field allows the blade to easily rip through armor and flesh alike.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <possessionCount>1</possessionCount>
                            <graphicData>
                                <texPath>Weapons/Power Sword 2</texPath>
                            </graphicData>
                            <uiIconScale>1.2</uiIconScale>
                            <techLevel>Spacer</techLevel>
                            <weaponTags>
                                <li>SpacerMeleeDecent</li>
                            </weaponTags>
                            <statBases>
                                <Mass>1.6</Mass>
                            </statBases>
                            <relicChance>2</relicChance>
                            <equippedAngleOffset>-65</equippedAngleOffset>

                            <tools>
                                <li>
                                    <label>handle</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>12.0</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>point</label>
                                    <capacities>
                                        <li>Stab</li>
                                    </capacities>
                                    <power>35.477</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>edge</label>
                                    <capacities>
                                        <li>Cut</li>
                                    </capacities>
                                    <power>35.477</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>
                    </value>
                </li>

                <li Class="PatchOperationFindMod">
                    <mods>
                        <li>XML Extensions</li>
                    </mods>

                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs</xpath>
                        <value>
                            <!-- MeleeWeapon_Chainsword_Bond -->
                            <ThingDef ParentName="MeleeWeapon_Chainsword_Bond">
                                <defName>MeleeWeapon_Chainsword_Bond</defName>
                            </ThingDef>

                            <!-- MeleeWeapon_Chainshortsword_Bond -->
                            <ThingDef ParentName="MeleeWeapon_Chainshortsword_Bond">
                                <defName>MeleeWeapon_Chainshortsword_Bond</defName>
                            </ThingDef>

                            <!-- MeleeWeapon_TrenchShovel_Bond -->
                            <ThingDef ParentName="MeleeWeapon_TrenchShovel_Bond">
                                <defName>MeleeWeapon_TrenchShovel_Bond</defName>
                            </ThingDef>

                            <!-- MeleeWeapon_PowerFist_Bond -->
                            <ThingDef ParentName="MeleeWeapon_PowerFist_Bond">
                                <defName>MeleeWeapon_PowerFist_Bond</defName>
                            </ThingDef>

                            <!-- MeleeWeapon_PowerSword_Bond -->
                            <ThingDef ParentName="MeleeWeapon_PowerSword_Bond">
                                <defName>MeleeWeapon_PowerSword_Bond</defName>
                            </ThingDef>

                            <!-- MeleeWeapon_PowerSwordtwo_Bond -->
                            <ThingDef ParentName="MeleeWeapon_PowerSwordtwo_Bond">
                                <defName>MeleeWeapon_PowerSwordtwo_Bond</defName>
                            </ThingDef>
                        </value>
                    </nomatch>

                    <match Class="PatchOperationSequence">
                        <operations>
                            <li Class="XmlExtensions.OptionalPatch" MayRequire="imranfish.xmlextensions">
                                <modId>Daria40K.MightyPersonaBondForgePatch</modId>
                                <key>Daria40K_MightyPersonaBondForgePatch_GrimworldMelee</key>
                                <defaultValue>true</defaultValue>

                                <caseTrue>
                                    <Operation Class="XmlExtensions.PatchOperationAdd">
                                        <xpath>Defs</xpath>
                                        <value>
                                            <!-- MeleeWeapon_Chainsword_Bond -->
                                            <ThingDef ParentName="MeleeWeapon_Chainsword_Bond">
                                                <defName>MeleeWeapon_Chainsword_Bond</defName>
                                            </ThingDef>

                                            <!-- MeleeWeapon_Chainshortsword_Bond -->
                                            <ThingDef ParentName="MeleeWeapon_Chainshortsword_Bond">
                                                <defName>MeleeWeapon_Chainshortsword_Bond</defName>
                                            </ThingDef>

                                            <!-- MeleeWeapon_TrenchShovel_Bond -->
                                            <ThingDef ParentName="MeleeWeapon_TrenchShovel_Bond">
                                                <defName>MeleeWeapon_TrenchShovel_Bond</defName>
                                            </ThingDef>

                                            <!-- MeleeWeapon_PowerFist_Bond -->
                                            <ThingDef ParentName="MeleeWeapon_PowerFist_Bond">
                                                <defName>MeleeWeapon_PowerFist_Bond</defName>
                                            </ThingDef>

                                            <!-- MeleeWeapon_PowerSword_Bond -->
                                            <ThingDef ParentName="MeleeWeapon_PowerSword_Bond">
                                                <defName>MeleeWeapon_PowerSword_Bond</defName>
                                            </ThingDef>

                                            <!-- MeleeWeapon_PowerSwordtwo_Bond -->
                                            <ThingDef ParentName="MeleeWeapon_PowerSwordtwo_Bond">
                                                <defName>MeleeWeapon_PowerSwordtwo_Bond</defName>
                                            </ThingDef>
                                        </value>
                                    </Operation>
                                </caseTrue>
                            </li>
                        </operations>
                    </match>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>