<?xml version="1.0" encoding="utf-8"?>
<!--
    ===== Impact Weaponry =====
-->
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Impact Weaponry</li>
        </mods>

        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <ThingDef ParentName="MPBFPM_BaseHumanMakeableGun" Name="DV_ImpactRifle_Bond" Abstract="True">
                            <techLevel>Spacer</techLevel>
                            <label>persona impact rifle</label>
                            <description>A compact and deadly spacer tech rifle, specially loaded with impact-tip ammo. Each shot violently explodes once it reaches its target, turning unarmored foes and enemy structures alike into mist. Imperial marines can often be heard shouting warcries to their emperor while shooting down opponents with these weapons.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <graphicData>
                                <texPath>Things/WeaponRanged/ImpactRifle</texPath>
                                <drawSize>1.05</drawSize>
                                <onGroundRandomRotateAngle>35</onGroundRandomRotateAngle>
                            </graphicData>
                            <soundInteract>Interact_Rifle</soundInteract>
                            <generateCommonality>1.8</generateCommonality>
                            <statBases>
                                <Mass>5.2</Mass>
                                <AccuracyTouch>0.715</AccuracyTouch>
                                <AccuracyShort>0.825</AccuracyShort>
                                <AccuracyMedium>0.55</AccuracyMedium>
                                <AccuracyLong>0.385</AccuracyLong>
                                <RangedWeapon_Cooldown>1.7</RangedWeapon_Cooldown>
                            </statBases>
                            <weaponTags>
                                <li>SpacerGun</li>
                            </weaponTags>
                            <tradeTags>
                                <li>WeaponRanged</li>
                            </tradeTags>
                            <weaponClasses>
                                <li>RangedHeavy</li>
                            </weaponClasses>
                            <verbs>
                                <li>
                                    <verbClass>Verb_Shoot</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>ImpactBullet_Bond</defaultProjectile>
                                    <warmupTime>1.02</warmupTime>
                                    <range>24</range>
                                    <forcedMissRadius>0.06</forcedMissRadius>
                                    <burstShotCount>5</burstShotCount>
                                    <ticksBetweenBurstShots>14</ticksBetweenBurstShots>
                                    <soundCast>Shot_ImpactRifle</soundCast>
                                    <soundCastTail>GunTail_Medium</soundCastTail>
                                    <muzzleFlashScale>9</muzzleFlashScale>
                                </li>
                            </verbs>
                            <tools>
                                <li>
                                    <label>handle</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>barrel</label>
                                    <capacities>
                                        <li>Blunt</li>
                                        <li>Poke</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseHumanMakeableGun" Name="DV_ImpactStubber_Bond" Abstract="True">
                            <techLevel>Spacer</techLevel>
                            <label>persona impact stubber</label>
                            <description>Essentially a shrunk down version of the impact rifle, the impact stubber is a small and bulky sidearm, loaded with impact-tip ammo that explodes on target. The stubber is commonly used by imperial soldiers for it's portability and power.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <graphicData>
                                <texPath>Things/WeaponRanged/ImpactStubber</texPath>
                                <drawSize>1.05</drawSize>
                                <onGroundRandomRotateAngle>35</onGroundRandomRotateAngle>
                            </graphicData>
                            <soundInteract>Interact_Revolver</soundInteract>
                            <generateCommonality>1.4</generateCommonality>
                            <statBases>
                                <Mass>4.2</Mass>
                                <AccuracyTouch>0.715</AccuracyTouch>
                                <AccuracyShort>0.825</AccuracyShort>
                                <AccuracyMedium>0.495</AccuracyMedium>
                                <AccuracyLong>0.33</AccuracyLong>
                                <RangedWeapon_Cooldown>1.02</RangedWeapon_Cooldown>
                            </statBases>
                            <weaponTags>
                                <li>SpacerGun</li>
                            </weaponTags>
                            <tradeTags>
                                <li>WeaponRanged</li>
                            </tradeTags>
                            <weaponClasses>
                                <li>RangedLight</li>
                            </weaponClasses>
                            <verbs>
                                <li>
                                    <verbClass>Verb_Shoot</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>ImpactBullet_Bond</defaultProjectile>
                                    <warmupTime>0.85</warmupTime>
                                    <range>22.6</range>
                                    <forcedMissRadius>0.06</forcedMissRadius>
                                    <soundCast>Shot_ImpactSmall</soundCast>
                                    <soundCastTail>GunTail_Medium</soundCastTail>
                                    <muzzleFlashScale>6</muzzleFlashScale>
                                </li>
                            </verbs>
                            <tools>
                                <li>
                                    <label>handle</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>front</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseHumanMakeableGun" Name="DV_ImpactCannon_Bond" Abstract="True">
                            <techLevel>Spacer</techLevel>
                            <label>persona impact cannon</label>
                            <description>A large and terrifying handheld cannon designed to fire bursts of explosive impact-tip shells, making it ideal for destroying enemy fortifications. While it has a slow firing rate, its long range makes it favored by imperial bombardiers for elimiating both rebel outposts and the occasional skull.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <equippedAngleOffset>45</equippedAngleOffset>
                            <graphicData>
                                <texPath>Things/WeaponRanged/ImpactCannon</texPath>
                                <drawSize>1.35</drawSize>
                                <onGroundRandomRotateAngle>35</onGroundRandomRotateAngle>
                            </graphicData>
                            <soundInteract>Interact_ChargeRifle</soundInteract>
                            <generateCommonality>0.3</generateCommonality>
                            <statBases>
                                <Mass>6.6</Mass>
                                <AccuracyTouch>0.66</AccuracyTouch>
                                <AccuracyShort>0.77</AccuracyShort>
                                <AccuracyMedium>0.605</AccuracyMedium>
                                <AccuracyLong>0.44</AccuracyLong>
                                <RangedWeapon_Cooldown>1.87</RangedWeapon_Cooldown>
                            </statBases>
                            <weaponTags>
                                <li>SpacerGun</li>
                            </weaponTags>
                            <tradeTags>
                                <li>WeaponRanged</li>
                            </tradeTags>
                            <weaponClasses>
                                <li>RangedHeavy</li>
                            </weaponClasses>
                            <verbs>
                                <li>
                                    <verbClass>Verb_Shoot</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>ImpactBulletBig_Bond</defaultProjectile>
                                    <warmupTime>1.36</warmupTime>
                                    <range>30</range>
                                    <forcedMissRadius>0.1</forcedMissRadius>
                                    <burstShotCount>3</burstShotCount>
                                    <ticksBetweenBurstShots>38</ticksBetweenBurstShots>
                                    <soundCast>Shot_ImpactCannon</soundCast>
                                    <soundCastTail>GunTail_Heavy</soundCastTail>
                                    <muzzleFlashScale>9</muzzleFlashScale>
                                </li>
                            </verbs>
                            <tools>
                                <li>
                                    <label>barrel</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>bar</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseHumanMakeableGun" Name="DV_ImpactSlinger_Bond" Abstract="True">
                            <techLevel>Spacer</techLevel>
                            <label>persona impact Slinger</label>
                            <description>A powerful shoulder-fired mortar engineered to fire large impact-tip shells at enemy targets. The built-in revolving magazine allows the user to fire off a devastating four-burst shot; perfect for leveling structures and armies alike. This destructive versatility makes it the preferred weapon for imperial breaching battalions, and even the bravest rebels have come to fear the shrieking whistles the shells make as they soar though the air.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>

                            <graphicData>
                                <texPath>Things/WeaponRanged/ImpactSlinger</texPath>
                                <drawSize>1.25</drawSize>
                                <onGroundRandomRotateAngle>35</onGroundRandomRotateAngle>
                            </graphicData>
                            <soundInteract>Interact_ChargeRifle</soundInteract>
                            <generateCommonality>0.3</generateCommonality>
                            <statBases>
                                <Mass>5.7</Mass>
                                <AccuracyTouch>0.66</AccuracyTouch>
                                <AccuracyShort>0.715</AccuracyShort>
                                <AccuracyMedium>0.55</AccuracyMedium>
                                <AccuracyLong>0.495</AccuracyLong>
                                <RangedWeapon_Cooldown>1.7</RangedWeapon_Cooldown>
                            </statBases>
                            <weaponTags>
                                <li>SpacerGun</li>
                            </weaponTags>
                            <tradeTags>
                                <li>WeaponRanged</li>
                            </tradeTags>
                            <weaponClasses>
                                <li>RangedHeavy</li>
                            </weaponClasses>
                            <verbs>
                                <li>
                                    <verbClass>Verb_Shoot</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>ImpactBulletShell_Bond</defaultProjectile>
                                    <warmupTime>1.19</warmupTime>
                                    <range>28</range>
                                    <forcedMissRadius>0.1</forcedMissRadius>
                                    <burstShotCount>4</burstShotCount>
                                    <ticksBetweenBurstShots>23</ticksBetweenBurstShots>
                                    <soundCast>Shot_ImpactRifle</soundCast>
                                    <soundCastTail>GunTail_Heavy</soundCastTail>
                                    <muzzleFlashScale>9</muzzleFlashScale>
                                </li>
                            </verbs>
                            <tools>
                                <li>
                                    <label>front</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>grip</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseHumanMakeableGun" Name="DV_ImpactSniper_Bond" Abstract="True">
                            <techLevel>Spacer</techLevel>
                            <label>persona impact sniper</label>
                            <description>A heavy sniper rifle designed to fire explosive impact tip shells. It boasts a massive range of fire and high accuracy due to the extended barrel and powerful sights. These are employed by imperial snipers to eliminate targets without heavily damaging important structures, such as a captured base.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <equippedAngleOffset>45</equippedAngleOffset>
                            <graphicData>
                                <texPath>Things/WeaponRanged/ImpactSniper</texPath>
                                <drawSize>1.20</drawSize>
                                <onGroundRandomRotateAngle>35</onGroundRandomRotateAngle>
                            </graphicData>
                            <soundInteract>Interact_ChargeRifle</soundInteract>
                            <generateCommonality>0.2</generateCommonality>
                            <statBases>
                                <Mass>5.6</Mass>
                                <AccuracyTouch>0.495</AccuracyTouch>
                                <AccuracyShort>0.792</AccuracyShort>
                                <AccuracyMedium>0.891</AccuracyMedium>
                                <AccuracyLong>0.979</AccuracyLong>
                                <RangedWeapon_Cooldown>2.55</RangedWeapon_Cooldown>
                            </statBases>
                            <weaponTags>
                                <li>SpacerGun</li>
                            </weaponTags>
                            <tradeTags>
                                <li>WeaponRanged</li>
                            </tradeTags>
                            <weaponClasses>
                                <li>RangedHeavy</li>
                            </weaponClasses>
                            <verbs>
                                <li>
                                    <verbClass>Verb_Shoot</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>ImpactBulletSniper_Bond</defaultProjectile>
                                    <warmupTime>2.38</warmupTime>
                                    <range>48</range>
                                    <forcedMissRadius>0.1</forcedMissRadius>
                                    <soundCast>Shot_ImpactSniper</soundCast>
                                    <soundCastTail>GunTail_Heavy</soundCastTail>
                                    <muzzleFlashScale>9</muzzleFlashScale>
                                </li>
                            </verbs>
                            <tools>
                                <li>
                                    <label>barrel</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>stock</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.75</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseBullet" Name="ImpactBullet_Bond" Abstract="True">
                            <label>Impact bullet</label>
                            <thingClass>Projectile_Explosive</thingClass>
                            <graphicData>
                                <texPath>Things/ImpactBullet</texPath>
                                <shaderType>TransparentPostLight</shaderType>
                            </graphicData>
                            <projectile>
                                <damageDef>Bomb</damageDef>
                                <explosionRadius>0.6</explosionRadius>
                                <damageAmountBase>18</damageAmountBase>
                                <speed>55</speed>
                            </projectile>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseBullet" Name="ImpactBulletBig_Bond" Abstract="True">
                            <label>large impact bullet</label>
                            <thingClass>Projectile_Explosive</thingClass>
                            <graphicData>
                                <texPath>Things/ImpactBulletBig</texPath>
                                <shaderType>TransparentPostLight</shaderType>
                            </graphicData>
                            <projectile>
                                <damageDef>Bomb</damageDef>
                                <explosionRadius>1.5</explosionRadius>
                                <damageAmountBase>14</damageAmountBase>
                                <speed>51</speed>
                            </projectile>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseBullet" Name="ImpactBulletShell_Bond" Abstract="True">
                            <label>impact shell</label>
                            <thingClass>Projectile_Explosive</thingClass>
                            <graphicData>
                                <texPath>Things/ImpactBulletShell</texPath>
                                <shaderType>TransparentPostLight</shaderType>
                            </graphicData>
                            <projectile>
                                <damageDef>Bomb</damageDef>
                                <explosionRadius>2.2</explosionRadius>
                                <damageAmountBase>15</damageAmountBase>
                                <speed>42</speed>
                            </projectile>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseBullet" Name="ImpactBulletSniper_Bond" Abstract="True">
                            <label>impact sniper shell</label>
                            <thingClass>Projectile_Explosive</thingClass>
                            <graphicData>
                                <texPath>Things/ImpactBulletSniper</texPath>
                                <shaderType>TransparentPostLight</shaderType>
                            </graphicData>
                            <projectile>
                                <damageDef>Bomb</damageDef>
                                <explosionRadius>1.6</explosionRadius>
                                <damageAmountBase>20</damageAmountBase>
                                <speed>53</speed>
                            </projectile>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseBullet" Name="ImpactBulletSlugger_Bond" Abstract="True">
                            <label>Impact slug</label>
                            <thingClass>Projectile_Explosive</thingClass>
                            <graphicData>
                                <texPath>Things/ImpactBulletSlugger</texPath>
                                <shaderType>TransparentPostLight</shaderType>
                            </graphicData>
                            <projectile>
                                <damageDef>Bomb</damageDef>
                                <explosionRadius>0.4</explosionRadius>
                                <damageAmountBase>14</damageAmountBase>
                                <speed>48</speed>
                            </projectile>
                        </ThingDef>
                    </value>
                </li>

                <li Class="PatchOperationFindMod">
                    <mods>
                        <li>XML Extensions</li>
                    </mods>

                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs</xpath>
                        <value>
                            <!-- DV_ImpactRifle_Bond -->
                            <ThingDef ParentName="DV_ImpactRifle_Bond">
                                <defName>DV_ImpactRifle_Bond</defName>
                            </ThingDef>

                            <!-- DV_ImpactStubber_Bond -->
                            <ThingDef ParentName="DV_ImpactStubber_Bond">
                                <defName>DV_ImpactStubber_Bond</defName>
                            </ThingDef>

                            <!-- DV_ImpactCannon_Bond -->
                            <ThingDef ParentName="DV_ImpactCannon_Bond">
                                <defName>DV_ImpactCannon_Bond</defName>
                            </ThingDef>

                            <!-- DV_ImpactSlinger_Bond -->
                            <ThingDef ParentName="DV_ImpactSlinger_Bond">
                                <defName>DV_ImpactSlinger_Bond</defName>
                            </ThingDef>

                            <!-- DV_ImpactSniper_Bond -->
                            <ThingDef ParentName="DV_ImpactSniper_Bond">
                                <defName>DV_ImpactSniper_Bond</defName>
                            </ThingDef>

                            <!-- ImpactBullet_Bond -->
                            <ThingDef ParentName="ImpactBullet_Bond">
                                <defName>ImpactBullet_Bond</defName>
                            </ThingDef>

                            <!-- ImpactBulletBig_Bond -->
                            <ThingDef ParentName="ImpactBulletBig_Bond">
                                <defName>ImpactBulletBig_Bond</defName>
                            </ThingDef>

                            <!-- ImpactBulletShell_Bond -->
                            <ThingDef ParentName="ImpactBulletShell_Bond">
                                <defName>ImpactBulletShell_Bond</defName>
                            </ThingDef>

                            <!-- ImpactBulletSniper_Bond -->
                            <ThingDef ParentName="ImpactBulletSniper_Bond">
                                <defName>ImpactBulletSniper_Bond</defName>
                            </ThingDef>

                            <!-- ImpactBulletSlugger_Bond -->
                            <ThingDef ParentName="ImpactBulletSlugger_Bond">
                                <defName>ImpactBulletSlugger_Bond</defName>
                            </ThingDef>
                        </value>
                    </nomatch>

                    <match Class="PatchOperationSequence">
                        <operations>
                            <li Class="XmlExtensions.OptionalPatch" MayRequire="imranfish.xmlextensions">
                                <modId>Daria40K.MightyPersonaBondForgePatch</modId>
                                <key>Daria40K_MightyPersonaBondForgePatch_ImpactWeaponry</key>
                                <defaultValue>true</defaultValue>

                                <caseTrue>
                                    <Operation Class="XmlExtensions.PatchOperationAdd">
                                        <xpath>Defs</xpath>
                                        <value>
                                            <!-- DV_ImpactRifle_Bond -->
                                            <ThingDef ParentName="DV_ImpactRifle_Bond">
                                                <defName>DV_ImpactRifle_Bond</defName>
                                            </ThingDef>

                                            <!-- DV_ImpactStubber_Bond -->
                                            <ThingDef ParentName="DV_ImpactStubber_Bond">
                                                <defName>DV_ImpactStubber_Bond</defName>
                                            </ThingDef>

                                            <!-- DV_ImpactCannon_Bond -->
                                            <ThingDef ParentName="DV_ImpactCannon_Bond">
                                                <defName>DV_ImpactCannon_Bond</defName>
                                            </ThingDef>

                                            <!-- DV_ImpactSlinger_Bond -->
                                            <ThingDef ParentName="DV_ImpactSlinger_Bond">
                                                <defName>DV_ImpactSlinger_Bond</defName>
                                            </ThingDef>

                                            <!-- DV_ImpactSniper_Bond -->
                                            <ThingDef ParentName="DV_ImpactSniper_Bond">
                                                <defName>DV_ImpactSniper_Bond</defName>
                                            </ThingDef>

                                            <!-- ImpactBullet_Bond -->
                                            <ThingDef ParentName="ImpactBullet_Bond">
                                                <defName>ImpactBullet_Bond</defName>
                                            </ThingDef>

                                            <!-- ImpactBulletBig_Bond -->
                                            <ThingDef ParentName="ImpactBulletBig_Bond">
                                                <defName>ImpactBulletBig_Bond</defName>
                                            </ThingDef>

                                            <!-- ImpactBulletShell_Bond -->
                                            <ThingDef ParentName="ImpactBulletShell_Bond">
                                                <defName>ImpactBulletShell_Bond</defName>
                                            </ThingDef>

                                            <!-- ImpactBulletSniper_Bond -->
                                            <ThingDef ParentName="ImpactBulletSniper_Bond">
                                                <defName>ImpactBulletSniper_Bond</defName>
                                            </ThingDef>

                                            <!-- ImpactBulletSlugger_Bond -->
                                            <ThingDef ParentName="ImpactBulletSlugger_Bond">
                                                <defName>ImpactBulletSlugger_Bond</defName>
                                            </ThingDef>
                                        </value>
                                    </Operation>
                                </caseTrue>
                            </li>
                        </operations>
                    </match>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
