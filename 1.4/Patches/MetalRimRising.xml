<?xml version="1.0" encoding="utf-8"?>
<!--
    ===== Metal Rim Rising =====
-->
<Patch>
    <Operation Class="XmlExtensions.FindMod">
        <mods>
            <li>mgr.rim</li>
        </mods>
        <packageId>true</packageId>

        <caseTrue>
            <Operation Class="XmlExtensions.PatchOperationAdd">
                <xpath>Defs</xpath>
                <value>
                    <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality" Name="MGR_RaidenSword_Bond" Abstract="True">
                        <label>persona Maverick Blade</label>
                        <description>A standard-issue High-Frequency Blade that is intended for security personnel. Designed for speed without sacrificing power, the blade enhances the wielder's move speed with providing excellent damage.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                        <graphicData>
                            <texPath>Things/Item/Equipment/WeaponMelee/raiden-sword</texPath>
                            <graphicClass>Graphic_Single</graphicClass>
                            <drawSize>(1,1)</drawSize>
                        </graphicData>
                        <size>(1,1)</size>
                        <techLevel>Spacer</techLevel>
                        <weaponTags>
                            <li>SpacerMeleeAdvanced</li>
                        </weaponTags>
                        <generateCommonality>0.0</generateCommonality>
                        <statBases>
                            <Mass>1.5</Mass>
                        </statBases>
                        <equippedStatOffsets>
                            <MoveSpeed>1.5</MoveSpeed>
                            <MeleeHitChance>-0.1</MeleeHitChance>
                            <MeleeDodgeChance>1.5</MeleeDodgeChance>
                        </equippedStatOffsets>
                        <relicChance>2</relicChance>
                        <equippedAngleOffset>-30</equippedAngleOffset>
                        <tools>
                            <li>
                                <label>handle</label>
                                <capacities>
                                    <li>Blunt</li>
                                </capacities>
                                <power>10.828</power>
                                <cooldownTime>0.85</cooldownTime>
                            </li>
                            <li>
                                <label>point</label>
                                <capacities>
                                    <li>Stab</li>
                                </capacities>
                                <power>15.464</power>
                                <cooldownTime>0.85</cooldownTime>
                                <armorPenetration>0.869</armorPenetration>
                            </li>
                            <li>
                                <label>edge</label>
                                <capacities>
                                    <li>Cut</li>
                                </capacities>
                                <power>35.477</power>
                                <cooldownTime>0.85</cooldownTime>
                                <armorPenetration>0.869</armorPenetration>
                            </li>
                        </tools>
                        <allowedArchonexusCount>1</allowedArchonexusCount>
                    </ThingDef>
                    <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality" Name="MeleeWeapon_MGR_Katana_Bond" Abstract="True">
                        <label>persona Duelist Objectifier</label>
                        <description>A highly experimental and unstable High-Frequency Blade that excels against armored targes, able to bypass even the toughest of plating after a short charge up time.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                        <graphicData>
                            <texPath>Things/Item/Equipment/WeaponMelee/mgr-katana</texPath>
                            <graphicClass>Graphic_Single</graphicClass>
                            <drawSize>(1,1)</drawSize>
                        </graphicData>
                        <size>(1,1)</size>
                        <techLevel>Spacer</techLevel>
                        <weaponTags>
                            <li>SpacerMeleeAdvanced</li>
                        </weaponTags>
                        <generateCommonality>0.0</generateCommonality>
                        <statBases>
                            <Mass>1.5</Mass>
                        </statBases>
                        <relicChance>2</relicChance>
                        <equippedAngleOffset>-40</equippedAngleOffset>
                        <tools>
                            <li>
                                <label>handle</label>
                                <capacities>
                                    <li>Blunt</li>
                                </capacities>
                                <power>15.464</power>
                                <cooldownTime>0.637</cooldownTime>
                            </li>
                            <li>
                                <label>point</label>
                                <capacities>
                                    <li>Stab</li>
                                </capacities>
                                <power>18.873</power>
                                <cooldownTime>0.637</cooldownTime>
                                <armorPenetration>1.133</armorPenetration>
                            </li>
                            <li>
                                <label>edge</label>
                                <capacities>
                                    <li>Cut</li>
                                </capacities>
                                <power>40.916</power>
                                <cooldownTime>0.637</cooldownTime>
                                <armorPenetration>1.133</armorPenetration>
                            </li>
                        </tools>
                        <allowedArchonexusCount>1</allowedArchonexusCount>
                        <comps>
                            <li Class="MGRRimworld.MGRComps.CompProperties_ItemAddAbility">
                                <hediff>DuelistObjectifierPower</hediff>
                            </li>
                        </comps>
                    </ThingDef>
                    <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality" Name="MeleeWeapon_MGR_Katana_Jump_Bond" Abstract="True">
                        <label>persona Duelist Objectifier (RUSH)</label>
                        <description>A highly experimental and unstable High-Frequency Blade that excels against armored targes, able to bypass even the toughest of plating after a short charge up time.\n\nThis variant comes with a jump ability and counts as a ranged weapon.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                        <graphicData>
                            <texPath>Things/Item/Equipment/WeaponMelee/mgr-katana</texPath>
                            <graphicClass>Graphic_Single</graphicClass>
                            <drawSize>(1,1)</drawSize>
                        </graphicData>
                        <size>(1,1)</size>
                        <techLevel>Spacer</techLevel>
                        <weaponTags>
                            <li>SpacerMeleeAdvanced</li>
                        </weaponTags>
                        <generateCommonality>0.0</generateCommonality>
                        <statBases>
                            <Mass>1.5</Mass>
                        </statBases>
                        <relicChance>2</relicChance>
                        <equippedAngleOffset>-40</equippedAngleOffset>
                        <tools>
                            <li>
                                <label>handle</label>
                                <capacities>
                                    <li>Blunt</li>
                                </capacities>
                                <power>12.866</power>
                                <cooldownTime>0.637</cooldownTime>
                            </li>
                            <li>
                                <label>point</label>
                                <capacities>
                                    <li>Stab</li>
                                </capacities>
                                <power>15.968</power>
                                <cooldownTime>0.637</cooldownTime>
                                <armorPenetration>1.03</armorPenetration>
                            </li>
                            <li>
                                <label>edge</label>
                                <capacities>
                                    <li>Cut</li>
                                </capacities>
                                <power>36.479</power>
                                <cooldownTime>0.637</cooldownTime>
                                <armorPenetration>1.03</armorPenetration>
                            </li>
                        </tools>
                        <allowedArchonexusCount>1</allowedArchonexusCount>
                        <verbs>
                            <li>
                                <label>true damage ability</label>
                                <verbClass>MGRRimworld.Effect_TrueDamage</verbClass>
                                <hasStandardCommand>true</hasStandardCommand>
                                <commandIcon>UI/sword-slice</commandIcon>
                                <range>8</range>
                                <requireLineOfSight>true</requireLineOfSight>
                                <warmupTime>1.5</warmupTime>
                                <warmupEffecter>MGR_Katana_Blast</warmupEffecter>
                                <noiseRadius>5</noiseRadius>
                                <ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
                                <soundCast>Pawn_Melee_BigBash_HitPawn</soundCast>
                                <soundCastTail>GunTail_Heavy</soundCastTail>
                                <soundAiming>OrbitalTargeter_Aiming</soundAiming>
                                <targetParams>
                                    <canTargetAnimals>false</canTargetAnimals>
                                    <canTargetBuildings>false</canTargetBuildings>
                                    <canTargetLocations>false</canTargetLocations>
                                </targetParams>
                                <defaultProjectile>Projectile_BaseAbility_Bond</defaultProjectile>
                            </li>
                        </verbs>
                        <comps>
                            <li Class="MGRRimworld.MGRComps.CompProperties_ItemAddAbility">
                                <hediff>DuelistObjectifierPower</hediff>
                            </li>
                        </comps>
                    </ThingDef>
                    <ThingDef ParentName="MPBFPM_BaseBullet" Name="Projectile_BaseAbility_Bond" Abstract="True">
                        <label>my ability projectile</label>
                        <description>Projectile for true damage ability.</description>
                        <graphicData>
                            <texPath>Things/Projectile/Bullet_Small</texPath>
                        </graphicData>
                        <projectile>
                            <damageDef>Stun</damageDef>
                            <damageAmountBase>0</damageAmountBase>
                            <speed>80</speed>
                        </projectile>
                    </ThingDef>
                </value>
            </Operation>

            <Operation Class="XmlExtensions.OptionalPatch">
                <modId>Daria40K.MightyPersonaBondForgePatch</modId>
                <key>Daria40K_MightyPersonaBondForgePatch_MetalRimRising</key>
                <defaultValue>true</defaultValue>

                <caseTrue>
                    <Operation Class="XmlExtensions.PatchOperationAdd">
                        <xpath>Defs</xpath>
                        <value>
                            <ThingDef ParentName="MGR_RaidenSword_Bond">
                                <defName>MGR_RaidenSword_Bond</defName>
                            </ThingDef>
                            <ThingDef ParentName="MeleeWeapon_MGR_Katana_Bond">
                                <defName>MeleeWeapon_MGR_Katana_Bond</defName>
                            </ThingDef>
                            <ThingDef ParentName="MeleeWeapon_MGR_Katana_Jump_Bond">
                                <defName>MeleeWeapon_MGR_Katana_Jump_Bond</defName>
                            </ThingDef>
                            <ThingDef ParentName="Projectile_BaseAbility_Bond">
                                <defName>Projectile_BaseAbility_Bond</defName>
                            </ThingDef>
                        </value>
                    </Operation>
                </caseTrue>
            </Operation>
        </caseTrue>
    </Operation>
</Patch>