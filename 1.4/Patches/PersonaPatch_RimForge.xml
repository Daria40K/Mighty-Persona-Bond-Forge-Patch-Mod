<?xml version="1.0" encoding="utf-8"?>
<!--
    ===== RimForge =====
-->
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>RimForge</li>
        </mods>

        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <ThingDef ParentName="MPBFPM_BaseWeapon">
                            <defName>RF_CursedKhopesh_Bond</defName>
                            <label>persona cursed khopesh</label>
                            <description>A cursed weapon, it's great power comes from the corrupted mind of it's wielder.
                        
                        People who's mind has not be corrupted by Zir will feel terrible if they equip this weapon.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>

                            <techLevel>Medieval</techLevel>
                            <smeltable>false</smeltable>
                            <burnableByRecipe>true</burnableByRecipe>
                            <tradeability>Sellable</tradeability>
                            <thingCategories>
                                <li>WeaponsMelee</li>
                            </thingCategories>
                            <graphicData>
                                <texPath>RF/Weapons/CursedKhopesh</texPath>
                                <graphicClass>Graphic_Single</graphicClass>
                                <drawSize>(1.3,1.3)</drawSize>
                            </graphicData>
                            <statBases>
                                <MarketValue>5500.0</MarketValue>
                                <MaxHitPoints>300</MaxHitPoints>
                                <Mass>5</Mass>
                            </statBases>
                            <equippedStatOffsets>
                                <MoveSpeed>0.4</MoveSpeed>
                            </equippedStatOffsets>
                            <equippedAngleOffset>-40</equippedAngleOffset>
                            <tools>
                                <li>
                                    <label>blade</label>
                                    <capacities>
                                        <li>Cut</li>
                                    </capacities>
                                    <power>22.0</power>
                                    <armorPenetration>0.88</armorPenetration>
                                    <cooldownTime>0.935</cooldownTime>
                                </li>
                            </tools>
                            <comps>
                                <li Class="RimForge.Comps.CompProperties_OversizedWeapon"/>
                            </comps>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality">
                            <defName>RF_GaeBulg_Bond</defName>
                            <label>persona g√°e bulg</label>
                            <description>A red spear-like weapon, as heavy as it is lethal.
                        It has more spikey bits to make it easier to poke people with.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <graphicData>
                                <texPath>RF/Weapons/GaeBulg</texPath>
                                <graphicClass>Graphic_Single</graphicClass>
                                <drawSize>(1.65,1.65)</drawSize>
                            </graphicData>
                            <techLevel>Medieval</techLevel>
                            <statBases>
                                <MaxHitPoints>300</MaxHitPoints>
                                <Mass>5</Mass>
                            </statBases>
                            <equippedStatOffsets>
                                <MoveSpeed>0.1</MoveSpeed>
                            </equippedStatOffsets>
                            <equippedAngleOffset>20</equippedAngleOffset>
                            <tools>
                                <li>
                                    <label>point</label>
                                    <capacities>
                                        <li>Stab</li>
                                    </capacities>
                                    <power>27.5</power>
                                    <armorPenetration>0.66</armorPenetration>
                                    <cooldownTime>1.275</cooldownTime>
                                </li>
                            </tools>
                            <comps>
                                <li Class="RimForge.Comps.CompProperties_OversizedWeapon"/>
                            </comps>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp_Quality">
                            <defName>RF_Khopesh_Bond</defName>
                            <label>persona khopesh</label>
                            <description>The khopesh saw an increase in popularity after humans left Old Earth.
                        It was sought after as an ornamental sidearm, and quickly gained popularity across many colony worlds.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <techLevel>Medieval</techLevel>
                            <smeltable>true</smeltable>
                            <burnableByRecipe>true</burnableByRecipe>
                            <tradeability>All</tradeability>
                            <graphicData>
                                <texPath>RF/Weapons/Khopesh</texPath>
                                <graphicClass>Graphic_Single</graphicClass>
                                <drawSize>(1.3,1.3)</drawSize>
                            </graphicData>
                            <statBases>
                                <MarketValue>660.0</MarketValue>
                                <MaxHitPoints>100</MaxHitPoints>
                                <Mass>4</Mass>
                            </statBases>
                            <equippedStatOffsets>
                                <MoveSpeed>0.4</MoveSpeed>
                            </equippedStatOffsets>
                            <equippedAngleOffset>-40</equippedAngleOffset>
                            <tools>
                                <li>
                                    <label>blade</label>
                                    <capacities>
                                        <li>Cut</li>
                                    </capacities>
                                    <power>16.5</power>
                                    <armorPenetration>0.55</armorPenetration>
                                    <cooldownTime>0.935</cooldownTime>
                                </li>
                            </tools>
                            <comps>
                                <li Class="RimForge.Comps.CompProperties_OversizedWeapon"/>
                            </comps>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseHumanMakeableGun">
                            <defName>RF_StablePistol_Bond</defName>
                            <label>persona stable pistol</label>
                            <techLevel>Industrial</techLevel>
                            <description>An advanced military pistol with excellent accuracy, range and rate of fire, but very poor damage.
                        Made using metal alloys.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <graphicData>
                                <texPath>RF/Weapons/StablePistol</texPath>
                                <graphicClass>Graphic_Single</graphicClass>
                            </graphicData>
                            <statBases>
                                <Mass>2.0</Mass>
                                <AccuracyTouch>0.99</AccuracyTouch>
                                <AccuracyShort>1.045</AccuracyShort>
                                <AccuracyMedium>0.88</AccuracyMedium>
                                <AccuracyLong>0.825</AccuracyLong>
                                <RangedWeapon_Cooldown>0.17</RangedWeapon_Cooldown>
                                <MarketValue>2530.0</MarketValue>
                            </statBases>
                            <soundInteract>Interact_Rifle</soundInteract>
                            <weaponTags>
                                <li>IndustrialGunAdvanced</li>
                            </weaponTags>
                            <verbs>
                                <li>
                                    <verbClass>Verb_Shoot</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>RF_Bullet_StablePistol_Bond</defaultProjectile>
                                    <warmupTime>0.212</warmupTime>
                                    <range>34.5</range>
                                    <burstShotCount>1</burstShotCount>
                                    <soundCast>RF_Sound_StableRifleShot</soundCast>
                                    <soundCastTail>GunTail_Medium</soundCastTail>
                                    <muzzleFlashScale>10</muzzleFlashScale>
                                </li>
                            </verbs>
                            <tools>
                                <li>
                                    <label>stock</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>5.5</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>barrel</label>
                                    <capacities>
                                        <li>Blunt</li>
                                        <li>Poke</li>
                                    </capacities>
                                    <power>5.5</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_Bullet">
                            <defName>RF_Bullet_StablePistol_Bond</defName>
                            <label>stable pistol bullet</label>
                            <graphicData>
                                <texPath>Things/Projectile/Bullet_Small</texPath>
                            </graphicData>
                            <projectile>
                                <damageAmountBase>6</damageAmountBase>
                                <stoppingPower>0.5</stoppingPower>
                                <speed>120</speed>
                            </projectile>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseHumanMakeableGun">
                            <defName>RF_StableRifle_Bond</defName>
                            <label>persona stable rifle</label>
                            <techLevel>Industrial</techLevel>
                            <description>An advanced military rifle with excellent accuracy, range and stability, but very poor damage.
                        Made using metal alloys.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <graphicData>
                                <texPath>RF/Weapons/StableRifle</texPath>
                                <graphicClass>Graphic_Single</graphicClass>
                            </graphicData>
                            <statBases>
                                <Mass>3.8</Mass>
                                <AccuracyTouch>0.88</AccuracyTouch>
                                <AccuracyShort>1.045</AccuracyShort>
                                <AccuracyMedium>0.99</AccuracyMedium>
                                <AccuracyLong>0.935</AccuracyLong>
                                <RangedWeapon_Cooldown>0.595</RangedWeapon_Cooldown>
                                <MarketValue>2970.0</MarketValue>
                            </statBases>
                            <soundInteract>Interact_Rifle</soundInteract>
                            <weaponTags>
                                <li>IndustrialGunAdvanced</li>
                            </weaponTags>
                            <equippedAngleOffset>30.3</equippedAngleOffset>
                            <verbs>
                                <li>
                                    <verbClass>Verb_Shoot</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>RF_Bullet_StableRifle_Bond</defaultProjectile>
                                    <warmupTime>0.34</warmupTime>
                                    <range>36.5</range>
                                    <ticksBetweenBurstShots>5</ticksBetweenBurstShots>
                                    <burstShotCount>5</burstShotCount>
                                    <soundCast>RF_Sound_StableRifleShot</soundCast>
                                    <soundCastTail>GunTail_Medium</soundCastTail>
                                    <muzzleFlashScale>12</muzzleFlashScale>
                                </li>
                            </verbs>
                            <tools>
                                <li>
                                    <label>stock</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>9.9</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>barrel</label>
                                    <capacities>
                                        <li>Blunt</li>
                                        <li>Poke</li>
                                    </capacities>
                                    <power>9.9</power>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                            </tools>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_Bullet">
                            <defName>RF_Bullet_StableRifle_Bond</defName>
                            <label>stable rifle bullet</label>
                            <graphicData>
                                <texPath>Things/Projectile/Bullet_Small</texPath>
                            </graphicData>
                            <projectile>
                                <damageAmountBase>7</damageAmountBase>
                                <stoppingPower>0.5</stoppingPower>
                                <speed>140</speed>
                            </projectile>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseWeapon">
                            <defName>RF_SwordOfDarkness_Bond</defName>
                            <label>persona Ea, Sword of Darkness</label>
                            <description>A cursed weapon, it's great power comes from the corrupted mind of it's wielder.
                        Can be reforged into 'Sen, Sword of Rapture' at a smithing table.
                        
                        People who's mind has not be corrupted by Zir will feel terrible if they equip this weapon.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>

                            <techLevel>Spacer</techLevel>
                            <smeltable>false</smeltable>
                            <burnableByRecipe>true</burnableByRecipe>
                            <tradeability>Sellable</tradeability>
                            <thingCategories>
                                <li>WeaponsMelee</li>
                            </thingCategories>
                            <graphicData>
                                <texPath>RF/Weapons/SwordOfDarkness</texPath>
                                <graphicClass>Graphic_Single</graphicClass>
                                <drawSize>(1.35,1.35)</drawSize>
                            </graphicData>
                            <statBases>
                                <MarketValue>6600.0</MarketValue>
                                <MaxHitPoints>300</MaxHitPoints>
                                <Mass>5</Mass>
                            </statBases>
                            <equippedStatOffsets>
                                <MoveSpeed>0.5</MoveSpeed>                                <!-- Gives +0.5 cps movement boost. Because I can. -->
                            </equippedStatOffsets>
                            <equippedAngleOffset>-40</equippedAngleOffset>
                            <tools>
                                <li>
                                    <label>blade</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>55.0</power>
                                    <armorPenetration>1.54</armorPenetration>
                                    <cooldownTime>0.935</cooldownTime>
                                </li>
                            </tools>
                            <comps>
                                <li Class="RimForge.Comps.CompProperties_OversizedWeapon"/>
                            </comps>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Blunt_Quality">
                            <defName>RF_SwordOfRapture_Bond</defName>
                            <label>persona Sen, Sword of Rapture</label>
                            <description>A purified and restored version of Ea, Sword of Darkness.
                        Despite it's designation as a sword, it's blade is actually blunt, dealing heavy crushing blows.
                        
                        People who hold this weapon feel it's warmth radiating through them, increased effect if they have the Blessing of Zir.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <graphicData>
                                <texPath>RF/Weapons/SwordOfRapture</texPath>
                                <graphicClass>Graphic_Single</graphicClass>
                                <drawSize>(1.35,1.45)</drawSize>
                            </graphicData>
                            <tradeability>Sellable</tradeability>
                            <techLevel>Spacer</techLevel>
                            <statBases>
                                <MaxHitPoints>300</MaxHitPoints>
                                <Mass>5</Mass>
                            </statBases>
                            <equippedStatOffsets>
                                <MoveSpeed>0.4</MoveSpeed>                                <!-- Gives +0.5 cps movement boost. Because I can. -->
                            </equippedStatOffsets>
                            <equippedAngleOffset>-40</equippedAngleOffset>
                            <tools>
                                <li>
                                    <label>blade</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>38.5</power>
                                    <armorPenetration>1.65</armorPenetration>
                                    <cooldownTime>0.935</cooldownTime>
                                </li>
                            </tools>
                            <comps>
                                <li Class="RimForge.Comps.CompProperties_OversizedWeapon"/>
                            </comps>
                        </ThingDef>

                        <ThingDef ParentName="MPBFPM_BaseMeleeWeapon_Sharp">
                            <defName>RF_VirtuousTreaty_Bond</defName>
                            <label>persona Virtuous Treaty</label>
                            <description>A huge longsword with a strange offset blade. Deals huge damage with high armor penetration.
                        Has a 75% chance to deflect bullets back at the attacker.
                        
                        Memories from another time stir within its pearly blade.\n\nThis weapon has an onboard persona that can bond to only a single person. The wielder and intelligent weapon can synchronize their reflexes and attack with frightening speed, accuracy, and creativity. Once bonded to a wielder, the weapon's persona will refuse to be wielded by anyone else.</description>
                            <graphicData>
                                <texPath>RF/Weapons/VirtuousTreaty</texPath>
                                <shaderType>CutoutComplex</shaderType>
                                <graphicClass>Graphic_Single</graphicClass>
                                <drawSize>(1.8,1.8)</drawSize>
                            </graphicData>
                            <costStuffCount>100</costStuffCount>
                            <stuffCategories>
                                <li>Metallic</li>
                            </stuffCategories>
                            <techLevel>Spacer</techLevel>
                            <weaponTags>
                                <li>SpacerMeleeAdvanced</li>
                            </weaponTags>
                            <statBases>
                                <MarketValue>3850.0</MarketValue>
                                <MaxHitPoints>500</MaxHitPoints>
                                <Mass>8</Mass>
                            </statBases>
                            <equippedStatOffsets>
                                <MoveSpeed>0.25</MoveSpeed>                                <!-- Gives +0.25 cps movement boost. Because I can. -->
                            </equippedStatOffsets>
                            <equippedAngleOffset>-45</equippedAngleOffset>
                            <tools>
                                <li>
                                    <label>point</label>
                                    <capacities>
                                        <li>Stab</li>
                                    </capacities>
                                    <power>33.0</power>
                                    <armorPenetration>1.21</armorPenetration>
                                    <cooldownTime>1.7</cooldownTime>
                                </li>
                                <li>
                                    <label>edge</label>
                                    <capacities>
                                        <li>Cut</li>
                                    </capacities>
                                    <power>38.5</power>
                                    <armorPenetration>0.99</armorPenetration>
                                    <cooldownTime>1.913</cooldownTime>
                                </li>
                            </tools>
                            <comps>
                                <li Class="RimForge.Comps.CompProperties_OversizedWeapon">
                                    <southOffset>(0.4, 0, 0.3)</southOffset>
                                    <northOffset>(0.4, 0, 0.3)</northOffset>
                                    <eastOffset>(0.3, 0, 0.38)</eastOffset>
                                    <westOffset>(-0.3, 0, 0.38)</westOffset>
                                </li>
                                <li Class="RimForge.Comps.CompProperties_Deflector">
                                    <deflectChance>0.75</deflectChance>
                                    <reflectChance>1</reflectChance>
                                </li>
                            </comps>
                        </ThingDef>
                    </value>
                </li>

                <li Class="XmlExtensions.OptionalPatch" MayRequire="imranfish.xmlextensions">
                    <modId>Daria40K.MightyPersonaBondForgePatch</modId>
                    <key>Daria40K_MightyPersonaBondForgePatch_RimForge</key>
                    <defaultValue>true</defaultValue>
                    <caseFalse>
                        <!-- RF_CursedKhopesh_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_CursedKhopesh_Bond"]</xpath>
                        </Operation>
                        <!-- RF_GaeBulg_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_GaeBulg_Bond"]</xpath>
                        </Operation>
                        <!-- RF_Khopesh_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_Khopesh_Bond"]</xpath>
                        </Operation>
                        <!-- RF_StablePistol_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_StablePistol_Bond"]</xpath>
                        </Operation>
                        <!-- RF_Bullet_StablePistol_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_Bullet_StablePistol_Bond"]</xpath>
                        </Operation>
                        <!-- RF_StableRifle_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_StableRifle_Bond"]</xpath>
                        </Operation>
                        <!-- RF_Bullet_StableRifle_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_Bullet_StableRifle_Bond"]</xpath>
                        </Operation>
                        <!-- RF_SwordOfDarkness_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_SwordOfDarkness_Bond"]</xpath>
                        </Operation>
                        <!-- RF_SwordOfRapture_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_SwordOfRapture_Bond"]</xpath>
                        </Operation>
                        <!-- RF_VirtuousTreaty_Bond -->
                        <Operation Class="XmlExtensions.PatchOperationRemove">
                            <xpath>Defs/ThingDef[defName="RF_VirtuousTreaty_Bond"]</xpath>
                        </Operation>
                    </caseFalse>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>